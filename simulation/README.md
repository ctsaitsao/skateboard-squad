# Skateboard Simulation

## Usage
### MATLAB Dependencies
- Optimization Toolbox
- Control System Toolbox

### Overview
Application entry point is `main.m`, which calls (through wrapper functions) dynamics-related functions that are automatically generated by running `derive_equations.mlx`. That means `derive_equations.mlx` has to be run before `main.m` is run for the first time. The workflow is depicted below.

<img src="../media/template_architecture.svg" width="700">

`derive_equations.mlx` uses symbolic computation to generate the state-space dynamics of the skateboard robot, which are then exported as MATLAB functions (e.g., `autogen_drift_vector_field.m` and `autogen_control_vector_field.m`).

### Autogenerated functions and wrappers
`derive_equations.mlx` uses `matlabFunction(variable,'File','filename')` extensively, to convert symbolic expressions to MATLAB functions that can be evaluated numerically.
However, these functions often require many input arguments.
For example, the autogenerated function that computes the conservative forces looks like this:

```Matlab
function G_q = autogen_conservative_forces(boardMass,boardTheta,boardHeight,bottomLinkRCoM,bottomLinkMass,bottomLinkTheta,bottomLinkHeight,g,topLinkRCoM,topLinkMass,topLinkTheta)
...
```
All those inputs arguments should not be supplied individually. Instead, they can be grouped into two categories:
- Robot state: `x = [boardX; boardY; boardTheta; bottomLinkTheta; topLinkTheta; boardDX; boardDY; boardDTheta; bottomLinkDTheta; topLinkDTheta]`.
- Parameters: literally everything else in the example above.

#### MATLAB structs and parsers
In addition to physical parameters (mass, length, etc) that anchor the dynamics in reality, there are many other parameters relevant to simulation, such as timestep size, appearance of the skateboard robot, etc. All the parameters are grouped into a struct called `params`, which is generated by calling `init_params.m`. This struct gets passed around throughout the simulation, and saves from having to worry about the order in which input arguments are supplied.

Another way to avoid input argument order-dependency (a trademark of brittle code) is to use Name-Value pairs. Name-Value pairs rely on an "input parser"; see `plot_robot.m` and `animate_robot.m` to see how this works.

### Steps
1. Run `derive_equations.mlx` to generate all autogenerated MATLAB files.
2. Run `main.m` and specify which trick to perform. This file calls all other function files, including `animate_robot.m` which outputs an `output.avi` video of the simulated skateboard performing the trick.

## Files

## Deriving Equations
